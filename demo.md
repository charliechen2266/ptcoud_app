# 点云/MESH数据组合查看器使用说明

## 简介

数据组合查看器是一个用于处理和分析点云数据及图像文件的工具。该工具提供了多种功能，包括点云数据的可视化、网格生成、曝光检测等。本文档将引导您如何使用此工具及其主要功能。

## 界面介绍

### 主窗口

![主窗口显示](images/主窗口显示.jpg)

- **窗口标题**: `Data Combitation Viewer`
- **菜单栏**: 包含“文件”和“视图”两个菜单。
- **工具栏**: 包含用于操作的按钮，例如切换显示模式、检测过曝情况等。
- **视图区域**: 显示点云数据和网格的区域。

### 菜单项
![文件按钮显示](images/文件按钮.png)
- **文件**:
  - **输出所有过曝组的照片**: 导出所有检测到的过曝图像。
  - **输出缺少 PLY 文件的图片组**: 导出缺少 PLY 文件的图片组。

![视图按钮显示](images/视图按钮.png)
- **视图**:
  - **切换显示模式**: 切换点云和网格显示模式。
  - **检测图像中的过曝情况**: 运行过曝检测并显示结果。

### 工具栏按钮
![工具栏按钮显示](images/工具栏按钮.jpg)
- **切换显示模式**: 切换显示模式（点云模式或网格模式）。
- **检测图像中的过曝情况**: 运行过曝检测功能。
- **输出所有过曝组的照片**: 导出所有过曝图像。
- **输出缺少 PLY 文件的图片组**: 导出缺少 PLY 文件的图片组。

## PLY Processor 使用说明

该程序通过处理点云数据生成 PLY 文件并计算曲率，最终生成带有密度过滤的网格文件。此程序支持多线程处理所有子文件夹下的点云数据。

在使用该程序时，可以根据需求调整以下参数：

![点云计算参数输入](images/点云计算参数输入.jpg)
### 1. `roi_radius` (浮点数)
- **说明**: 指定用于计算曲率的感兴趣区域（ROI）的半径。单位为米。
- **默认值**: 0.5
- **注意事项**: 如果输入负值，程序将使用绝对值进行计算。

### 2. `threshold` (浮点数)
- **说明**: 曲率阈值，用于决定点云中的点是否超过阈值从而被着色。
- **默认值**: 0.0003
- **作用**: 点云中曲率超过此阈值的点将被标记为红色。

### 3. `erosion_ratio` (浮点数)
- **说明**: 在计算曲率时使用的侵蚀比率，用于缩小感兴趣区域的范围，以排除边缘效应。
- **默认值**: 0.01
- **作用**: 通过去除感兴趣区域的边缘点来提高曲率计算的准确性。

### 4. `density_threshold` (浮点数)
- **说明**: 密度阈值，用于过滤网格的顶点。只有密度大于该阈值的顶点才会被保留。
- **默认值**: 0.1
- **作用**: 控制生成网格的稀疏度，以防止网格过于密集或稀疏。

## 文件路径参数

### `data_folder_path`
- **说明**: 指定输入点云数据的根文件夹路径。程序将递归处理该文件夹下的所有子文件夹。

### `output_folder_path`
- **说明**: 指定输出结果文件的根文件夹路径。程序将在此文件夹中保存处理后的点云和网格文件。


## UI界面使用说明

### 设置曝光检测参数

1. **打开曝光检测对话框**: 点击工具栏上的“检测图像中的过曝情况”按钮，然后选择“设置曝光检测参数”。
![曝光参数输入](images/曝光参数.jpg)
2. **输入参数**:
   - **曝光阈值**: 输入用于检测曝光的阈值（推荐值：235）。
   - **连续像素数要求**: 输入检测曝光时连续像素的最小数量（推荐值：5）。
   - **最大曝光组数**: 输入允许的最大曝光组数。（推荐值：10）
3. **确认设置**: 点击“确定”保存设置，点击“取消”放弃设置。

### 切换显示模式

1. **选择显示模式**: 点击工具栏上的“切换显示模式”按钮。
2. **查看结果**: 切换后的模式将自动更新视图区域，切换点云或者MESH视图
***
![点云显示模式](images/点云显示模式.jpg)
***
![MESH显示模式](images/MESH显示模式.jpg)

### 导出过曝图像

1. **选择导出选项**: 从菜单栏选择“文件” -> “输出所有过曝组的照片”。
2. **查看导出结果**: 工具将自动处理并导出所有过曝图像，导出到项目文件根目录下`output_exposure_photos`

### 导出缺少 PLY 文件的图片组

1. **选择导出选项**: 从菜单栏选择“文件” -> “输出缺少 PLY 文件的图片组”。
2. **查看导出结果**: 工具将自动处理并导出所有缺少 PLY 文件的图片组。`output_missing_ply_photos`

## 常见问题

- **如何处理程序无响应的问题？**
  - 检查是否所有文件路径都正确，确保相关文件夹存在。
  - 检查在`data-combitation`当中是否有不符合data格式的文件夹存在（详情请见注意事项）
  - 尝试减少生成ply的时候的线程数量（默认`min(os.cpu_count() - 4, 100)`）
  - 尝试重启程序，检查是否仍然出现问题。

- **如何更新曝光检测参数？**
  - 点击工具栏上的“检测图像中的过曝情况”按钮，选择“设置曝光检测参数”，然后更新所需的参数值。

## 注意事项

- **程序在运行之前，首先要检查[data-combitation](data-combitation)中的各个data文件夹中必须是以calib文件夹+tiff文件夹+datainfo文件的格式存在的**

    ![data文件夹格式](images/data文件夹格式.jpg)

- **程序在运行之前需要检查输出文件夹是否被清空，不然会造成ply文件生成混乱**

    ![输出文件夹文件删除注意](images/输出文件夹文件删除注意.jpg)

- **程序在运行之后再第二次运行之前需要删除在程序根目录下面的[debug_folder](debug_folder)**

    ![debug_folder删除注意](images/debug_folder删除注意.jpg)

- **如果在输出文件夹当中已经没有ply文件存在，那么曝光警告将不再生效，而是只产生丢失ply警告**

## 联系方式

如需进一步帮助，请联系技术支持：[support@example.com](mailto:support@example.com) 或访问我们的 [技术支持网站](http://example.com/support)。

---

感谢使用点云/MESH数据组合查看器！
